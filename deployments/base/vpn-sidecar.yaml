apiVersion: v1
kind: Pod
metadata:
  name: sidecar-test
  namespace: random-workloads
  labels:
    app.kubernetes.io/name: sidecar-test
spec:
  containers:
    - name: sidecar-main
      image: nicolaka/netshoot
      command: ["tail"]
      args: ["-f", "/dev/null"]
    - name: qbitttorrent
      image: lscr.io/linuxserver/qbittorrent:latest
      env:
        - name: PUID
          value: "1000"
        - name: PGUI
          value: "1000"
        - name: TZ
          value: "Europe/Berlin"
        - name: WEBUI_PORT
          value: "8080"
      ports:
        - containerPort: 8080
    - name: wireguard
      image: ghcr.io/linuxserver/wireguard
      imagePullPolicy: IfNotPresent
      securityContext:
        privileged: true
        capabilities:
          add:
            - NET_ADMIN
            - SYS_MODULE
        allowPrivilegeEscalation: true
        readOnlyRootFilesystem: false
      volumeMounts:
        - name: test-volume
          mountPath: /config
          subPath: configs/wireguard/
  volumes:
    - name: test-volume
      nfs:
        server: desktop
        path: /bigdata/media/
        readOnly: false
